<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joe's Goals Replica - Simple Goal Tracker</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .tagline {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* Setup Section */
        .setup-section {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .setup-section h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .setup-section p {
            margin-bottom: 15px;
            color: #666;
            line-height: 1.6;
        }

        .setup-section code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .setup-section pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .setup-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .setup-form button {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        .setup-form button:hover {
            background: #45a049;
        }

        /* Login/Register Section */
        .auth-section {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            margin-bottom: -2px;
        }

        .auth-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .auth-form button {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .auth-form button:hover {
            background: #45a049;
        }

        .error-message {
            color: #f44336;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .success-message {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* Goal Tracker Section */
        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sync-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: #e3f2fd;
            color: #1976D2;
        }

        .sync-status.syncing {
            background: #fff3e0;
            color: #f57c00;
        }

        .sync-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .logout-btn {
            padding: 5px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        /* Week Navigation */
        .week-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .week-nav button {
            padding: 5px 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .week-nav button:hover {
            background: #1976D2;
        }

        .week-display {
            font-weight: bold;
            color: #333;
        }

        /* Goals Table */
        .goals-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .goals-table th {
            background: #f0f0f0;
            padding: 10px;
            text-align: center;
            font-size: 13px;
            font-weight: normal;
            color: #666;
            border: 1px solid #ddd;
        }

        .goals-table th:first-child {
            text-align: left;
            min-width: 200px;
        }

        .goals-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .goal-name {
            text-align: left;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .goal-type {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 3px;
            color: white;
        }

        .goal-type.positive {
            background: #4CAF50;
        }

        .goal-type.negative {
            background: #f44336;
        }

        .delete-goal {
            margin-left: auto;
            padding: 2px 8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Check Boxes */
        .check-cell {
            cursor: pointer;
            user-select: none;
            font-size: 20px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .check-cell:hover {
            background: #f5f5f5;
        }

        .check-positive {
            color: #4CAF50;
        }

        .check-negative {
            color: #f44336;
        }

        /* Score Row */
        .score-row td {
            background: #fafafa;
            font-weight: bold;
            padding: 10px;
        }

        .score-positive {
            color: #4CAF50;
        }

        .score-negative {
            color: #f44336;
        }

        .score-neutral {
            color: #666;
        }

        /* Add Goal Form */
        .add-goal-section {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .add-goal-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .add-goal-form input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-goal-form input[type="number"] {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-goal-form select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-goal-form button {
            padding: 8px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-goal-form button:hover {
            background: #45a049;
        }

        /* Stats Section */
        .stats-section {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
<div x-data="joesGoals()" x-init="init()">
    <!-- Main App: Always visible, local storage only -->
    <div class="container">
        <div class="tracker-header">
            <div>
                <h1>Joe's Goals Replica</h1>
                <p class="tagline">Track your goals, build better habits</p>
            </div>
        </div>

        <!-- Week Navigation -->
        <div class="week-nav">
            <button @click="previousWeek()">← Previous Week</button>
            <span class="week-display" x-text="weekDisplay"></span>
            <button @click="nextWeek()">Next Week →</button>
            <button @click="goToCurrentWeek()">Today</button>
        </div>

        <!-- Goals Table -->
        <table class="goals-table">
            <thead>
            <tr>
                <th>Goal</th>
                <template x-for="day in weekDays" :key="day.date">
                    <th>
                        <div x-text="day.dayName"></div>
                        <div style="font-size: 11px; color: #999;" x-text="day.shortDate"></div>
                    </th>
                </template>
            </tr>
            </thead>
            <tbody>
            <template x-for="goal in goals" :key="goal.id">
                <tr>
                    <td class="goal-name">
                        <span x-text="goal.name"></span>
                        <button @click="deleteGoal(goal.id)" class="delete-goal">×</button>
                    </td>
                    <template x-for="day in weekDays" :key="day.date">
                        <td>
                            <div
                                    class="check-cell"
                                    :class="getCheck(goal.id, day.date) ? 'check-positive' : ''"
                                    @click="toggleCheck(goal.id, day.date)"
                            >
                                <span x-show="getCheck(goal.id, day.date)">✓</span>
                            </div>
                        </td>
                    </template>
                </tr>
            </template>
            <!-- Score Row -->
            <tr class="score-row">
                <td>Daily Score</td>
                <template x-for="day in weekDays" :key="day.date">
                    <td>
                                <span
                                        x-text="getDayScore(day.date)"
                                        :class="{
                                        'score-positive': getDayScore(day.date) > 0,
                                        'score-negative': getDayScore(day.date) < 0,
                                        'score-neutral': getDayScore(day.date) === 0
                                    }"
                                ></span>
                    </td>
                </template>
            </tr>
            </tbody>
        </table>

        <!-- Add Goal Form -->
        <div class="add-goal-section">
            <h3 style="margin-bottom: 15px;">Add New Goal</h3>
            <div class="add-goal-form">
                <input
                        type="text"
                        x-model="newGoal.name"
                        placeholder="Goal name (e.g., Exercise, Read, No Smoking)"
                        @keyup.enter="addGoal()"
                >
                <button @click="addGoal()">Add Goal</button>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <h3>Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Week Score</div>
                    <div class="stat-value" x-text="weekScore"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Streak</div>
                    <div class="stat-value" x-text="bestStreak + ' days'"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Goals</div>
                    <div class="stat-value" x-text="goals.length"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">All goals completed today</div>
                    <div class="stat-value" x-text="goals.length === 0 ? '-' : (allGoalsCompletedToday ? '✅ Yes' : 'Not yet')"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function joesGoals() {
        return {
            goals: [],
            checks: {},
            currentWeekStart: null,
            weekDays: [],
            weekDisplay: '',
            newGoal: {
                name: ''
            },
            weekScore: 0,
            bestStreak: 0,
            allGoalsCompletedToday: false,
            init() {
                this.loadLocalData();
                this.goToCurrentWeek();
            },
            loadLocalData() {
                const userData = localStorage.getItem('jg_data_local');
                if (userData) {
                    const data = JSON.parse(userData);
                    this.goals = data.goals || [];
                    this.checks = data.checks || {};
                } else {
                    this.goals = [];
                    this.checks = {};
                }
            },
            saveLocalData() {
                localStorage.setItem('jg_data_local', JSON.stringify({
                    goals: this.goals,
                    checks: this.checks
                }));
            },
            addGoal() {
                if (!this.newGoal.name.trim()) {
                    alert('Please enter a goal name');
                    return;
                }
                const goal = {
                    id: Date.now().toString(),
                    name: this.newGoal.name.trim(),
                    created: new Date().toISOString()
                };
                this.goals.push(goal);
                this.checks[goal.id] = {};
                this.saveLocalData();
                this.calculateStats();
                this.newGoal = { name: '' };
            },
            deleteGoal(goalId) {
                if (confirm('Are you sure you want to delete this goal?')) {
                    this.goals = this.goals.filter(g => g.id !== goalId);
                    delete this.checks[goalId];
                    this.saveLocalData();
                    this.calculateStats();
                }
            },
            toggleCheck(goalId, date) {
                if (!this.checks[goalId]) {
                    this.checks[goalId] = {};
                }
                this.checks[goalId][date] = !this.checks[goalId][date];
                // Force Alpine.js reactivity by replacing the checks object
                this.checks = { ...this.checks };
                this.saveLocalData();
                this.calculateStats();
            },
            getCheck(goalId, date) {
                return !!this.checks[goalId]?.[date];
            },
            goToCurrentWeek() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const dayOfWeek = today.getDay();
                this.currentWeekStart = new Date(today);
                this.currentWeekStart.setDate(today.getDate() - dayOfWeek);
                this.updateWeekDisplay();
            },
            previousWeek() {
                this.currentWeekStart.setDate(this.currentWeekStart.getDate() - 7);
                this.updateWeekDisplay();
            },
            nextWeek() {
                this.currentWeekStart.setDate(this.currentWeekStart.getDate() + 7);
                this.updateWeekDisplay();
            },
            getLocalDateString(date) {
                // Returns YYYY-MM-DD in local time
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },
            updateWeekDisplay() {
                this.weekDays = [];
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(this.currentWeekStart);
                    date.setDate(this.currentWeekStart.getDate() + i);
                    this.weekDays.push({
                        date: this.getLocalDateString(date),
                        dayName: dayNames[i],
                        shortDate: `${date.getMonth() + 1}/${date.getDate()}`
                    });
                }
                const endDate = new Date(this.currentWeekStart);
                endDate.setDate(this.currentWeekStart.getDate() + 6);
                const startMonth = this.currentWeekStart.toLocaleDateString('en-US', { month: 'short' });
                const endMonth = endDate.toLocaleDateString('en-US', { month: 'short' });
                this.weekDisplay = `${startMonth} ${this.currentWeekStart.getDate()} - ${endMonth} ${endDate.getDate()}, ${endDate.getFullYear()}`;
                this.calculateStats();
            },
            getDayScore(date) {
                // No points, just count checked goals
                let score = 0;
                this.goals.forEach(goal => {
                    if (this.getCheck(goal.id, date)) {
                        score++;
                    }
                });
                return score > 0 ? `+${score}` : score.toString();
            },
            calculateStats() {
                // Week score: total checked goals for the week
                this.weekScore = 0;
                this.weekDays.forEach(day => {
                    this.weekScore += this.goals.reduce((sum, goal) => sum + (this.getCheck(goal.id, day.date) ? 1 : 0), 0);
                });
                // Best streak: max consecutive days all goals completed
                let currentStreak = 0;
                let maxStreak = 0;
                let streakDates = this.weekDays.map(day => day.date);
                streakDates.forEach(date => {
                    if (this.goals.length > 0 && this.goals.every(goal => this.getCheck(goal.id, date))) {
                        currentStreak++;
                        maxStreak = Math.max(maxStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                });
                this.bestStreak = maxStreak;
                // All goals completed today
                const today = this.getLocalDateString(new Date());
                this.allGoalsCompletedToday = this.goals.length > 0 && this.goals.every(goal => this.getCheck(goal.id, today));
            }
        }
    }
</script>
</body>
</html>
